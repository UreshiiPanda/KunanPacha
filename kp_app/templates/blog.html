{% extends "base.html" %}

{% block content %}

    {% load static %}
    {% static 'kp_app/images/bg1.jpg' as bg_url %}
    {% static 'kp_app/images/art1.jpg' as art1_url %}
    {% load auth_tags %}




<div
    x-data="{blog_modal:false}"
    id="blog-content"
    class="flex flex-col lg:flex-row h-screen relative">



        {% if user.is_authenticated %}
            {% if request.user|has_group:"Editor" %}
            <button 
                x-data
                @click="
                      $store.editBlogModal.currentBlogPost = {
                           id: 0,
                           title: '',
                           date: '',
                           description: '',
                           image1: null,
                           image2: null,
                           image3: null,
                           image4: null
                       };
                        console.log('~~~~~currentBlogPost~~~~~~');
                        console.log($store.editBlogModal.currentBlogPost.id);
                        console.log($store.editBlogModal.currentBlogPost.title);
                        console.log($store.editBlogModal.currentBlogPost.text);
                        console.log($store.editBlogModal.currentBlogPost.description);
                        console.log($store.editBlogModal.currentBlogPost.image1);
                        console.log($store.editBlogModal.currentBlogPost.image2);
                        console.log($store.editBlogModal.currentBlogPost.image3);
                        console.log($store.editBlogModal.currentBlogPost.image4);
                        $store.addBlogModal.showModal = true" 
                class="absolute mt-20 top-8 left-4 z-30 flex items-center px-3 py-2 border-2 border-white text-white bg-black hover:text-black hover:bg-white hover:border-black text-sm font-medium">
                Add Blog
            </button>
            {% endif %}
        {% endif %}



        <!-- ADD BLOG Modal backdrop -->
        <div x-cloak x-show="$store.addBlogModal.showModal" class=" fixed inset-0 bg-black text-black bg-opacity-50 flex items-center justify-center z-50">
          <!-- ADD BLOG Modal content -->
          <div x-cloak x-show="$store.addBlogModal.showModal" 
               x-transition:enter="transition ease-out duration-300"
               x-transition:enter-start="opacity-0 scale-90"
               x-transition:enter-end="opacity-100 scale-100"
               x-transition:leave="transition ease-in duration-300"
               x-transition:leave-start="opacity-100 scale-100"
               x-transition:leave-end="opacity-0 scale-90"
               class="bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl mx-4 overflow-y-auto max-h-[90vh]">
            
              <h2 class="text-2xl font-bold mb-4">Add New Blog Post</h2>
             
            <form 
                id="blogForm" 
                enctype="multipart/form-data"
                hx-encoding="multipart/form-data"
                hx-post="{% url 'add_blog' %}"
                hx-swap="none"
                hx-cache="false"
                hx-trigger="submit"
                hx-on::after-request="Alpine.store('addBlogModal').showModal = false"
            >
            {% csrf_token %}
              <div class="mb-4">
                <label for="blog_title" class="block text-sm font-medium text-gray-700">Blog Title:</label>
                <input type="text" id="blog_title" x-bind:value="$store.editBlogModal.currentBlogPost.title" name="blog_title" required placeholder="eg: unique title" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
              </div>

              <div class="mb-4">
                <label for="blog_description" class="block text-sm font-medium text-gray-700">Description:</label>
                <textarea id="blog_description"  x-bind:value="$store.editBlogModal.currentBlogPost.description" name="blog_description" rows="3" required placeholder="eg: un postito de blog..." class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
              </div>
  
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Photos:</label>
                <div class="flex flex-wrap space-x-4" id="imageContainer">
                  {% for i in '1234'|make_list %}
                  <div class="relative mb-4" id="imageWrapper{{ i }}">
                    <input type="file" 
                            id="imageInput{{ i }}" 
                            name="image{{ i }}" 
                            accept="image/*" 
                            class="hidden" 
                            onchange="previewImage(this, 'imagePreview{{ i }}')"
                            >

                      <img id="imagePreview{{ i }}" src="" 
                           {% if forloop.first %}
                               alt="Picture Required!" 
                            {% else %}
                                alt="Select Picture"
                            {% endif %}
                           class="w-24 h-24 object-cover rounded cursor-pointer" 
                           decoding="async"
                           onclick="document.getElementById('imageInput{{ i }}').click()">

                    <button type="button" class="absolute top-0 right-0 bg-white p-1 shadow-sm" onclick="removeImage('imageWrapper{{ i }}')">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-black" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                      </svg>
                    </button>
                  </div>
                  {% endfor %}
                </div>
              </div>

              <div class="mt-6 flex space-x-4">
                <button type="button" 
                    @click="$store.addBlogModal.showModal = false" 
                    class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
                    Cancel
                </button>

                <button 
                    type="submit"
                    hx-disabled-elt="this"
                    hx-disable-if="form:not(:valid)"
                    class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
                    Submit
                </button>
              </div>
            </form>
          </div>
        </div>






        <!-- Edit Blog Page Button -->        
        {% if user.is_authenticated %}
            {% if request.user|has_group:"Editor" %}
            <button 
                x-data 
                @click="blog_modal = true" 
                class="absolute top-4 left-4 flex items-center px-3 py-2 z-30 border-2 border-white text-white bg-black hover:text-black hover:bg-white hover:border-black text-sm font-medium">
                Edit Page
            </button>
            {% endif %}
        {% endif %}




                <!-- Edit Blog Page Modal -->
                <div x-cloak x-show="blog_modal" class="fixed inset-0 bg-black text-black bg-opacity-50 flex items-center justify-center z-50">
                  <div x-cloak x-show="blog_modal" 
                       x-transition:enter="transition ease-out duration-300"
                       x-transition:enter-start="opacity-0 scale-90"
                       x-transition:enter-end="opacity-100 scale-100"
                       x-transition:leave="transition ease-in duration-300"
                       x-transition:leave-start="opacity-100 scale-100"
                       x-transition:leave-end="opacity-0 scale-90"
                       class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">

                    <form 
                        id="imageForm1" 
                        enctype="multipart/form-data"
                        hx-encoding="multipart/form-data"
                        hx-post="{% url 'blog_page_edit' %}"
                        hx-swap="none"
                        hx-cache="false"
                    >
                    {% csrf_token %}
                        <div class="mb-4">
                          <label for="blog_title" class="block text-sm font-medium text-gray-700">Title:</label>
                          <input type="text" id="blog_title" name="blog_title" placeholder="blog title here" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-4">
                            <label for="blog_text" class="block text-sm font-medium text-gray-700">Blog Text:</label>
                            <textarea id="blog_text" name="blog_text" placeholder="blog text here" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                        </div>
                        
                        <div class="mb-4">
                          <label for="contact_facebook" class="block text-sm font-medium text-gray-700">Facebook Link:</label>
                          <input type="text" id="contact_facebook" name="contact_facebook" placeholder="https://www.facebook.com/meow" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <div class="mb-4">
                          <label for="contact_instagram" class="block text-sm font-medium text-gray-700">Instagram Link:</label>
                          <input type="text" id="contact_instagram" name="contact_instagram" placeholder="https://www.instagram.com/meow" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <div class="mb-4">
                          <label for="font" class="block text-sm font-medium text-gray-700">Font:</label>
                          <input type="text" id="font" name="blog_font" placeholder="sans-serif" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-4">
                          <label for="font_color" class="block text-sm font-medium text-gray-700">Font Color:</label>
                          <input type="text" id="font_color" name="blog_font_color" placeholder="black" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-4">
                          <label for="font_style" class="block text-sm font-medium text-gray-700">Font Style:</label>
                          <input type="text" id="font_style" name="blog_font_style" placeholder="italic, bold, normal" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <!-- Existing image input -->

                        <div class="mb-4">
                          <label class="block text-sm font-medium text-gray-700 mb-2">Photos:</label>
                          <div class="flex space-x-4" id="imageContainer">
                            <div class="relative" id="imageWrapper1">
                              <input type="file" id="imageInput1" name="blog_bg_image" accept="image/*" class="hidden" onchange="previewImage(this, 'imagePreview1')">
                              <img id="imagePreview1" src="" decoding="async" alt="Select Background Picture" class="w-24 h-24 object-cover rounded cursor-pointer" onclick="document.getElementById('imageInput1').click()">
                              <button type="button" class="absolute top-0 right-0 bg-white p-1 shadow-sm" onclick="removeImage('imageWrapper1')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-black" viewBox="0 0 20 20" fill="currentColor">
                                  <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                              </button>
                            </div>
                            <div class="relative" id="imageWrapper2">
                              <input type="file" id="imageInput2" name="blog_logo_image" accept="image/*" class="hidden" onchange="previewImage(this, 'imagePreview2')">
                              <img id="imagePreview2" src="" decoding="async" alt="Select Picture" class="w-24 h-24 object-cover rounded cursor-pointer" onclick="document.getElementById('imageInput2').click()">
                              <button type="button" class="absolute top-0 right-0 bg-white p-1 shadow-sm" onclick="removeImage('imageWrapper2')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-black" viewBox="0 0 20 20" fill="currentColor">
                                  <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                              </button>
                            </div>
                            <!-- Repeat for imageWrapper2 and imageWrapper3 -->
                          </div>
                        </div>

                      <div class="mt-6 flex space-x-4">
                        <button type="button" 
                            @click="blog_modal = false" 
                            class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
                            Cancel
                        </button>

                        <button 
                            type="submit"
                            @click="blog_modal = false" 
                            class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
                            Submit
                        </button>
                      </div>

                    </form>
                </div>
            </div>





        <!-- BLOG LEFT HALF -->

        <!-- Small navbar for screens below lg -->
        <div class="lg:hidden fixed top-4 right-4 z-20">
            {% include "navbar_blog_sm.html" %}
        </div>



        <div 
            x-data="{
                currentFontStyle: '{{page_settings.font_style}}',
                currentFont: '{{page_settings.font}}',
                currentColor: '{{page_settings.font_color}}',
                fontVariants: {
                    'sans-serif': 'font-sans',
                    'serif': 'font-serif',
                    'mono': 'font-mono',
                },
                colorVariants: {
                    'red-500': 'text-red-500',
                    'blue-500': 'text-blue-500',
                    'green-500': 'text-green-500',
                    'gray-900': 'text-gray-900',
                    'gray-800': 'text-gray-800',
                    'gray-700': 'text-gray-700',
                    'gray-600': 'text-gray-600',
                    'gray-500': 'text-gray-500',
                    'gray-400': 'text-gray-400',
                    'gray-300': 'text-gray-300',
                    'gray-200': 'text-gray-200',
                    'gray-100': 'text-gray-100',
                    'black': 'text-black',
                    'white': 'text-white',
                },
                hoverColorVariants: {
                   'text-red-500': 'hover:text-blue-500',
                   'text-blue-500': 'hover:text-red-500',
                   'text-green-500': 'hover-text-orange-500',
                   'text-gray-900': 'hover:text-gray-400',
                   'text-gray-800': 'hover:text-gray-400',
                   'text-gray-700': 'hover:text-gray-400',
                   'text-gray-600': 'hover:text-gray-300',
                   'text-gray-500': 'hover:text-black',
                   'text-gray-400': 'hover:text-gray-800',
                   'text-gray-300': 'hover:text-gray-800',
                   'text-gray-200': 'hover:text-gray-800',
                   'text-gray-100': 'hover:text-gray-700',
                   'text-black': 'hover:text-gray-400',
                   'text-white': 'hover:text-gray-700',
                },
                styleVariants: {
                    'italic': 'italic',
                    'bold': 'font-bold',
                    'normal': '',
                },
                smallMenu: false
            }" 
            :class="[
                styleVariants[currentFontStyle] || '',
                fontVariants[currentFont] || 'font-sans', 
                colorVariants[currentColor] || 'text-black',
            ]"
            class="h-2/5 lg:h-full lg:w-2/5 bg-cover bg-center relative" 
            style="background-image: url('{{ page_settings.blog_bg_image }}');"
            >


            <div class="absolute inset-0 flex flex-col items-center justify-center">
                <img 
                    src="{{ page_settings.blog_logo_image }}" 
                    alt="Blog Photo" 
                    class="w-32 h-32 rounded-full mb-4 object-cover shadow-[0_50px_50px_rgba(0,0,0,0.2)]"
                    style="box-shadow: 0 3px 3px rgba(0,0,0,0.4);"
                    >
                <h2 
                    class="text-2xl font-bold text-center" 
                    style="text-shadow: 0 3px 3px rgba(0,0,0,0.4);" 
                    >{{ page_settings.blog_title }}
                </h2>
                <p 
                    class="text-center mt-2 shadow-text"
                    style="text-shadow: 0 3px 3px rgba(0,0,0,0.4);"
                    >{{ page_settings.blog_text }}
                </p>
                
                <div class="flex justify-center space-x-8 mt-4">
                    <a href="https://www.instagram.com/" :class="hoverColorVariants[colorVariants[currentColor]] || 'hover:text-gray-400'" target="_blank">
                        <svg class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                        </svg>
                    </a>
                    <a href="https://www.facebook.com/" :class="hoverColorVariants[colorVariants[currentColor]] || 'hover:text-gray-400'" target="_blank">
                        <svg class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                        </svg>
                    </a>
                    <a href="https://www.tiktok.com/@meow" :class="hoverColorVariants[colorVariants[currentColor]] || 'hover:text-gray-400'" target="_blank">
                        <svg class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </div>


    <!-- BLOG RIGHT HALF -->
    <div class="h-3/5 lg:h-full lg:w-3/5 flex flex-col">
        <div class="hidden lg:block w-full">
            <!-- Large navbar for screens above lg -->
            {% include "navbar_blog.html" %}
        </div>


        <!-- BLOG POSTS -->
        <div class="space-y-12">
            {% for post in blog_posts %}
            <div class="blog-post">
                <h2 class="text-2xl font-bold m-4 text-center">{{ post.title }}</h2>
                
                <p class="text-center italic text-gray-400 mb-4">Published: {{ post.date|date:"F j, Y" }}</p>
               
                <!-- horizontal line -->
                <div class="flex justify-center">
                    <div class="w-1/4 border-t border-gray-300 my-4"></div>
                </div>
                
                <div class="relative" 
                    x-data="{ currentBlogImage: 0,
                              blogImages: {{ post.images }},
                            }">
                    <img :src="blogImages[currentBlogImage]" alt="Image Not Found" class="w-3/5 h-64 object-cover">
                    
                    <button 
                        @click="currentBlogImage = (currentBlogImage - 1 + blogImages.length) % blogImages.length" 
                        class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-80 text-white p-2">
                        &lt;
                    </button>
                    
                    <button 
                        @click="currentBlogImage = (currentBlogImage + 1) % blogImages.length" 
                        class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-80 text-white p-2">
                        &gt;
                    </button>
                </div>
                
                <div class="mt-4">
                    <p class="line-clamp-7">{{ post.description }}</p>
                    <button class="mt-2 text-gray-400 hover:underline">Continue reading...</button>
                </div>
            </div>
            
            <!-- horizontal line -->
            <hr class="border-t border-gray-300 my-8">
            {% endfor %}
        </div>

    </div>


</div>

        <!-- for image thumbnails & for removing them in the modals -->
        <script>
            function previewImage(input, previewId) {
              const file = input.files[0];
              if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                  document.getElementById(previewId).src = e.target.result;
                }
                reader.readAsDataURL(file);
              }
            }

            function removeImage(wrapperId) {
              const wrapper = document.getElementById(wrapperId);
              const input = wrapper.querySelector('input[type="file"]');
              const img = wrapper.querySelector('img');
              input.value = '';
              img.src = '';
            }
        </script>


{% endblock %}
