 {% extends "base.html" %}                                                                                                 
                                                                                                                           
 {% block content %}                                                                                                       
 {% load static %}                                                                                                         
 {% load auth_tags %}                                                                                                      
                                                                                                                           
 {% include "navbar.html" %}                                                                                               
                                                                                                                           
 <div x-data id="art-categories-content">                                                                                  
                                                                                                                           
     {% if user.is_authenticated %}                                                                                        
         {% if request.user|has_group:"Editor" %}                                                                          
         <button                                                                                                           
             x-data                                                                                                        
             @click="                                                                                                      
                     $store.addArtCategoryModal.currentCategory = {                                                           
                         id: 0,                                                                                            
                         name: '',                                                                                         
                         image1: null                                                                                       
                     };                                                                                                    
                        console.log('~~~~~currentCategory~~~~~~');
                        console.log($store.editArtCategoryModal.currentCategory.id);
                        console.log($store.editArtCategoryModal.currentCategory.name);
                        console.log($store.editArtCategoryModal.currentCategory.image1);
                     $store.addArtCategoryModal.showModal = true"                                                             
             class="fixed mt-20 top-4 right-4 z-10 flex items-center px-3 py-2 border-2 border-white text-white bg-black   
 hover:text-black hover:bg-white hover:border-black text-sm font-medium">                                                  
             Add Category                                                                                                  
         </button>                                                                                                         
         {% endif %}                                                                                                       
     {% endif %}                                                                                                           
                                                                                                                           
     <!-- ADD CATEGORY Modal backdrop -->                                                                                  
     <div x-cloak x-show="$store.addArtCategoryModal.showModal" class="fixed inset-0 bg-black text-black bg-opacity-50 flex   
 items-center justify-center z-50">                                                                                        
       <!-- ADD CATEGORY Modal content -->                                                                                 
       <div x-cloak x-show="$store.addArtCategoryModal.showModal"                                                             
            x-transition:enter="transition ease-out duration-300"                                                          
            x-transition:enter-start="opacity-0 scale-90"                                                                  
            x-transition:enter-end="opacity-100 scale-100"                                                                 
            x-transition:leave="transition ease-in duration-300"                                                           
            x-transition:leave-start="opacity-100 scale-100"                                                               
            x-transition:leave-end="opacity-0 scale-90"                                                                    
            class="bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl mx-4 overflow-y-auto max-h-[90vh]">                  
                                                                                                                           
         <h2 class="text-2xl font-bold mb-4">Add New Art Category</h2>                                                         
                                                                                                                           
         <form                                                                                                             
             id="categoryForm"                                                                                             
             enctype="multipart/form-data"                                                                                 
             hx-encoding="multipart/form-data"                                                                             
             hx-post="{% url 'add_art_category' %}"                                                                            
             hx-swap="none"                                                                                                
             hx-cache="false"                                                                                              
             hx-trigger="submit"                                                                                           
             hx-on::after-request="Alpine.store('addArtCategoryModal').showModal = false"                                     
         >                                                                                                                 
         {% csrf_token %}                                                                                                  
           <div class="mb-4">                                                                                              
             <label for="name" class="block text-sm font-medium text-gray-700">Name:</label>                               
             <input type="text" id="name" x-bind:value="$store.editArtCategoryModal.currentCategory.name" name="name" required placeholder="Category name" class="mt-1 block w-full        
 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">                                      
           </div>                                                                                                          
                                                                                                                           
                                                                                                                           
           <div class="mb-4">                                                                                              
             <label class="block text-sm font-medium text-gray-700 mb-2">Category Image:</label>                           
             <div class="flex flex-wrap space-x-4" id="imageContainer">                                                    
               <div class="relative mb-4" id="imageWrapper">                                                               
                 <input type="file"                                                                                        
                         id="imageInput"                                                                                   
                         name="image1"                                                                                      
                         accept="image/*"                                                                                  
                         class="hidden"                                                                                    
                         onchange="previewImage(this, 'imagePreview')"                                                     
                 >                                                                                         
                                                                                                                           
                   <img id="imagePreview" src=""                                                                           
                        alt="Select Picture"                                                                               
                        class="w-24 h-24 object-cover rounded cursor-pointer"                                              
                        decoding="async"                                                                                   
                        onclick="document.getElementById('imageInput').click()">                                           
                                                                                                                           
                    <button type="button" class="absolute top-0 right-0 bg-white p-1 shadow-sm" onclick="removeImage('imageWrapper')">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-black" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                      </svg>
                    </button>

               </div>                                                                                                      
             </div>                                                                                                        
           </div>                                                                                                          
                                                                                                                           
              <div class="mt-6 flex space-x-4">
                <button type="button" 
                    @click="$store.addArtCategoryModal.showModal = false" 
                    class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
                    Cancel
                </button>

                <button 
                    type="submit"
                    hx-disabled-elt="this"
                    hx-disable-if="form:not(:valid)"
                    class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
                    Submit
                </button>
              </div>


         </form>                                                                                                           
       </div>                                                                                                              
     </div>                                                                                                                
                                                                                                                           
     {% if categories %}                                                                                                   
     <!-- EDIT CATEGORY Modal backdrop -->                                                                                 
     <div                                                                                                                  
         x-cloak                                                                                                           
         x-show="$store.editArtCategoryModal.showModal"                                                                       
         class="fixed inset-0 bg-black text-black bg-opacity-50 flex items-center justify-center z-50">                    
       <!-- EDIT CATEGORY Modal content -->                                                                                
       <div                                                                                                                
         x-cloak                                                                                                           
         x-show="$store.editArtCategoryModal.showModal"                                                                       
            x-transition:enter="transition ease-out duration-300"                                                          
            x-transition:enter-start="opacity-0 scale-90"                                                                  
            x-transition:enter-end="opacity-100 scale-100"                                                                 
            x-transition:leave="transition ease-in duration-300"                                                           
            x-transition:leave-start="opacity-100 scale-100"                                                               
            x-transition:leave-end="opacity-0 scale-90"                                                                    
            class="bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl mx-4 overflow-y-auto max-h-[90vh]">                  
                                                                                                                           
         <h2 class="text-2xl font-bold mb-4">Edit Art Category</h2>                                                            
                                                                                                                           
         <form                                                                                                             
             id="editCategoryForm"                                                                                         
             enctype="multipart/form-data"                                                                                 
             hx-encoding="multipart/form-data"                                                                             
             hx-trigger="submit"                                                                                           
             hx-cache="false"                                                                                              
             hx-swap="none"                                                                                                
             hx-on::after-request="Alpine.store('editArtCategoryModal').showModal = false"                                    
             >                                                                                                             
         {% csrf_token %}                                                                                                  
           <div class="mb-4">                                                                                              
             <label for="name" class="block text-sm font-medium text-gray-700">Name:</label>                               
             <input type="text" id="nameEdit" x-bind:value="$store.editArtCategoryModal.currentCategory.name" name="name"     
 required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">    
           </div>                                                                                                          
                                                                                                                                                                      
           <div class="mb-4">                                                                                              
             <label class="block text-sm font-medium text-gray-700 mb-2">Category Image:</label>                           
             <div class="flex flex-wrap space-x-4" id="imageEditContainer">                                                
               <div x-data="{removed: 'false'}" class="relative mb-4" id="imageEditWrapper">                                 
                 <img                                                                                                      
                     src=""                                                                                                
                     alt="Select Picture"                                                                                  
                     decoding="async"                                                                                      
                     class="w-24 h-24 object-cover rounded cursor-pointer"                                                 
                     onclick="document.getElementById('imageEditInput').click()"                                           
                     id="imageEditPreview"                                                                                 
                 >                                                                                                         
                 <input                                                                                                    
                     type="file"                                                                                           
                     id="imageEditInput"                                                                                   
                     name="image1"                                                                                          
                     class="hidden"                                                                                        
                     onchange="previewImage(this, 'imageEditPreview')"                                                     
                 >                                                                                                         
                 <button                                                                                                   
                     type="button"                                                                                         
                     @click="removed = 'true';                                                                               
                     $store.editArtCategoryModal.currentCategory.image1 = '';                                                  
                     removeImage('imageEditWrapper')"                                                                      
                     class="absolute top-0 right-0 bg-white p-1 shadow-sm"                                                 
                     >              

                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-black" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                  </svg>

                 </button>                                                                                                 
                                                                                                                           
                 <input                                                                                                    
                     type="text"                                                                                           
                     x-ref="imageRemoveInput"                                                                              
                     id="imageRemoveInput"                                                                                 
                     name="removed"                                                                                        
                     class="hidden"                                                                                        
                     x-bind:value="removed"                                                                                
                 >                                                                                                         
               </div>                                                                                                      
             </div>                                                                                                        
           </div>                                                                                                          
                                                                                                                           
           <div class="mt-6 flex space-x-4">                                                                               
             <button type="button"                                                                                         
                 @click="$store.editArtCategoryModal.showModal = false"                                                       
                 class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-mediu 
 rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2         
 focus:ring-offset-2 focus:ring-black">                                                                                    
                 Cancel                                                                                                    
             </button>                                                                                                     
                                                                                                                           
             <button                                                                                                       
                 type="submit"                                                                                             
                 onclick="editCategoryPost(Alpine.store('editArtCategoryModal').currentCategory.id)"                          
                 class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-mediu 
 rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2         
 focus:ring-offset-2 focus:ring-black"                                                                                     
                 hx-disabled-elt="this"                                                                                    
                 hx-disable-if="form:not(:valid)"                                                                          
                 >                                                                                                         
                 Submit                                                                                                    
             </button>                                                                                                     
           </div>                                                                                                          
         </form>                                                                                                           
       </div>                                                                                                              
     </div>                                                                                                                
     {% endif %}                                                                                                           
                                                                                                                           




        <!-- EDIT PAGE Modal backdrop -->
        <div x-cloak x-show="$store.editPageModal.showModal" class="fixed inset-0 bg-black text-black bg-opacity-50 flex items-center justify-center z-50">
          <!-- EDIT PAGE Modal content -->
          <div x-cloak x-show="$store.editPageModal.showModal" 
               x-transition:enter="transition ease-out duration-300"
               x-transition:enter-start="opacity-0 scale-90"
               x-transition:enter-end="opacity-100 scale-100"
               x-transition:leave="transition ease-in duration-300"
               x-transition:leave-start="opacity-100 scale-100"
               x-transition:leave-end="opacity-0 scale-90"
               class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
            
            <h2 class="text-2xl font-bold mb-4">Edit Page Settings</h2>
            
            <form 
                hx-post="{% url 'art_categories_page_edit' %}" 
                hx-target="#art-categories-content"
                hx-cache="false"
                >
                {% csrf_token %}
              <input type="hidden" name="page_url" value="{{ request.path }}">
              
              <div class="mb-4">
                <label for="font" class="block text-sm font-medium text-gray-700">Font</label>
                <input type="text" id="font" name="font" 
                        placeholder="Enter font (eg: sans-serif)"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
              </div>

                <div class="mb-4">
                  <label for="font_color" class="block text-sm font-medium text-gray-700">Font Color</label>
                  <input type="text" id="font_color" name="font_color" 
                         placeholder="Enter font color (eg: gray-500)"
                         class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                </div>
                
                <div class="mb-4">
                  <label for="font_style" class="block text-sm font-medium text-gray-700">Font Style</label>
                  <input type="text" id="font_style" name="font_style" 
                         placeholder="Enter font type (eg: bold, italic, normal)"
                         class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                </div>


              <div class="mt-6 flex space-x-4">
                <button type="button" 
                    @click="$store.editPageModal.toggle()" 
                    class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
                    Cancel
                </button>

                <button 
                    type="submit"
                    @click="$store.editPageModal.toggle()" 
                    class="flex-1 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-white hover:text-black hover:border-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
                    Submit
                </button>
              </div>
            </form>
          </div>
        </div>



     <!-- Display categories -->                                                                                           
     <div                                                                                                                  
         class="flex flex-wrap justify-between"                                                                            
         x-data="{                                                                                                         
             currentFontStyle: '{{page_settings.font_style}}',                                                             
             currentFont: '{{page_settings.font}}',                                                                        
             currentColor: '{{page_settings.font_color}}',                                                                 
             fontVariants: {                                                                                               
                 'sans-serif': 'font-sans',                                                                                
                 'serif': 'font-serif',                                                                                    
                 'mono': 'font-mono',                                                                                      
             },                                                                                                            
             colorVariants: {                                                                                              
                 'red-500': 'text-red-500',                                                                                
                 'blue-500': 'text-blue-500',                                                                              
                 'green-500': 'text-green-500',                                                                            
                 'gray-900': 'text-gray-900',                                                                              
                 'gray-800': 'text-gray-800',                                                                              
                 'gray-700': 'text-gray-700',                                                                              
                 'gray-600': 'text-gray-600',                                                                              
                 'gray-500': 'text-gray-500',                                                                              
                 'gray-400': 'text-gray-400',                                                                              
                 'gray-300': 'text-gray-300',                                                                              
                 'gray-200': 'text-gray-200',                                                                              
                 'gray-100': 'text-gray-100',                                                                              
                 'black': 'text-black',                                                                                    
                 'white': 'text-white',                                                                                    
             },                                                                                                            
             styleVariants: {                                                                                              
                 'italic': 'italic',                                                                                       
                 'bold': 'font-bold',                                                                                      
                 'normal': '',                                                                                             
             }                                                                                                             
     }"                                                                                                                    
     :class="[                                                                                                             
         styleVariants[currentFontStyle] || '',                                                                            
         fontVariants[currentFont] || 'font-sans',                                                                         
         colorVariants[currentColor] || 'text-black',                                                                      
         'container', 'mx-auto', 'mt-24', 'px-4'                                                                           
     ]">                                                                                                                   
                                                                                                                           
     {% for category in categories %}                                                                                      
     <div class="flex flex-col items-center mx-auto md:w-1/2 lg:w-1/2 p-4">                                                
         <div class="relative border-2 border-black hover:cursor-pointer overflow-hidden h-[275px] w-[275px] md:h-[325px]  
 md:w-[325px] lg:h-[300px] lg:w-[300px] shadow-[0_10px_20px_rgba(0,0,0,0.3)] hover:shadow-[0_20px_30px_rgba(0,0,0,0.4)]    
 transition-shadow duration-300"                                                                                           
              @click="$store.editPageModal.showModal = false"                                                              
              hx-get="{% url 'art1' category.id %}"                                                             
              hx-swap="innerHTML scroll:top"                                                                                          
              hx-target="#art-categories-content"                                                                          
              hx-push-url="/art1/{{ category.id }}"
              hx-on::after-request="window.scrollTo(0, 0);"
              >                                                                   
             <img                                                                                                          
                 src="{{ category.image1 }}"                                                                            
                 alt="Image Not Found"                                                                                     
                 decoding="async"                                                                                          
                 class="p-4 h-full w-full object-cover"                                                                    
                 loading="lazy"                                                                                            
             >                                                                                                             
         </div>                                                                                                            
                                                                                                                           
         {% if user.is_authenticated %}                                                                                    
             {% if request.user|has_group:"Editor" %}                                                                      
         <div class="p-4 w-[275px] md:w-[325px] lg:w-[300px] relative">                                                    
             <h3 class="text-lg text-left break-words">{{ category.name }}</h3>                                            
                 <div class="flex justify-center space-x-4">                                                               
                 {% endif %}                                                                                               
                 {% else %}                                                                                                
         <div class="p-4 w-[275px] md:w-[325px] lg:w-[300px] relative">                                                    
             <h3 class="text-lg text-left pr-10 break-words">{{ category.name }}</h3>                                      
                 <div class="absolute top-4 right-4 flex space-x-2">                                                       
             {% endif %}                                                                                                   
                                                                                                                           
             {% if user.is_authenticated %}                                                                                
                 {% if request.user|has_group:"Editor" %}                                                                  
                 <button                                                                                                   
                         @click="                                                                                          
                                 $store.editArtCategoryModal.currentCategory = {                                              
                                     id: '{{category.id|escapejs}}',                                                       
                                     name: '{{category.name|escapejs}}',                                                   
                                     image1: 'null'                                                                           
                                 };                                                                                        
                                 $store.editArtCategoryModal.showModal = true"                                                
                         class="text-gray-600 hover:text-gray-900 transition-colors duration-300 mx-1">                    
                         <svg class="ml-1 h-8 w-8 text-black" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>

                 </button>                                                                                                 
                                                                                                                           
                 {% if categories %}                                                                                       
                     <button hx-delete="{% url 'delete_art_category' category.id %}"                                           
                             hx-confirm="Are you sure you want to delete this category?"                                   
                             hx-target="#art-categories-content"                                                           
                             class="text-gray-600 hover:text-gray-900 transition-colors duration-300 mx-1">                
                            <svg class="h-8 w-8 text-black" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>

                     </button>                                                                                             
                 {% endif %}                                                                                               
                 {% endif %}                                                                                               
             {% endif %}                                                                                                   
                                                                                                                           
             </div>                                                                                                        
         </div>                                                                                                            
     </div>                                                                                                                
     {% endfor %}                                                                                                          
                                                                                                                           
     </div>                                                                                                                
 </div>                                                                                                                    
                                                                                                                           
 <script>                                                                                                                  
     function previewImage(input, previewId) {                                                                             
       const file = input.files[0];                                                                                        
       if (file) {                                                                                                         
         const reader = new FileReader();                                                                                  
         reader.onload = function(e) {                                                                                     
           document.getElementById(previewId).src = e.target.result;                                                       
         }                                                                                                                 
         reader.readAsDataURL(file);                                                                                       
       }                                                                                                                   
                                                                                                                           
     }                                                                                                                     
                                                                                                                           
     function removeImage(wrapperId) {                                                                                     
       const wrapper = document.getElementById(wrapperId);                                                                 
       const input = wrapper.querySelector('input[type="file"]');                                                          
       const img = wrapper.querySelector('img');                                                                           
       input.value = '';                                                                                                   
       img.src = '';                                                                                                       
     }                                                                                                                     
                                                                                                                           
     function editCategoryPost() {                                                                                         
         id = Alpine.store('editArtCategoryModal').currentCategory.id                                                         
         htmx.ajax('POST', '{% url 'edit_art_category' 0 %}'.replace(0, id), {                                                 
            source: '#editCategoryForm',                                                                                   
         });                                                                                                               
     }                                                                                                                     
 </script>                                                                                                                 
                                                                                                                           
 {% endblock %}  
