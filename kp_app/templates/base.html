<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}
        Django App
      {% endblock %}
    </title>
    {% load static %}
    {% load auth_tags %}


    <!-- include summernote css/js -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>


    <!-- Favicon icon -->
    <link defer rel="icon" type="image/x-icon" href="{% static 'kp_app/images/art5.jpg' %}">

    <!-- Tailwind Styling -->
    <link rel="stylesheet" href="{% static 'kp_app/css/output.css' %}" type="text/css">

    <!-- HTMX Core -->
    <script type="text/javascript" src="{% static 'kp_app/htmx.min.js' %}" defer ></script>

    <!-- Alpine Plugins -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.x.x/dist/cdn.min.js"></script>
    <!-- Alpine Core -->
    <script type="text/javascript" src="{% static 'kp_app/alpine.min.js' %}" defer ></script>


  </head>
  <body class="h-screen w-screen" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>



        <!-- setup a global Alpine var for edit_page popups -->
        <script>
            document.addEventListener('alpine:init', () => {

                <!-- the editArtModal.currentArtwork is being re-used for the addArtModal in the templates to avoid an excess var -->
                Alpine.store('addBlogModal', {
                    showModal: false,
         
                    toggle() {
                        this.showModal = ! this.showModal
                        console.log("the ADD BLOG modal has just been toggled to", this.showModal, "\nnote that the modal will silently be set to false if the user navigates")
                    }
                }),
                Alpine.store('editBlogModal', {
                     showModal: false,

                     currentBlogPost:{
                         id: 0,
                         title: '',
                         date: '',
                         description: '',
                         image1: null,
                         image2: null,
                         image3: null,
                         image4: null,
                    },
                     previewImageEdit(event, index) {
                         const file = event.target.files[0];
                         if (file) {
                             const reader = new FileReader();
                             reader.onload = (e) => {
                                 console.log(this.currentBlogPost[`image${index}`]);
                                 this.currentBlogPost[`image${index}`] = e.target.result;
                                 console.log(this.currentBlogPost[`image${index}`]);
                             };
                             reader.readAsDataURL(file);
                          
                         }
                     },
         
                    toggle() {
                        this.showModal = ! this.showModal
                        console.log("the EDIT BLOG modal has just been toggled to", this.showModal, "\nnote that the modal will silently be set to false if the user navigates")
                    }
                }),

                <!-- the editArtModal.currentArtwork is being re-used for the addArtModal in the templates to avoid an excess var -->
                Alpine.store('addArtModal', {
                    showModal: false,
         
                    toggle() {
                        this.showModal = ! this.showModal
                        console.log("the ADD ART modal has just been toggled to", this.showModal, "\nnote that the modal will silently be set to false if the user navigates")
                    }
                }),
                Alpine.store('editArtModal', {
                     showModal: false,

                     currentArtwork:{
                         id: 0,
                         title: '',
                         original_price: '',
                         print_price: '',
                         description: '',
                         dimensions: '',
                         image1: null,
                         image2: null,
                         image3: null,
                         image4: null,
                    },
                     previewImageEdit(event, index) {
                         const file = event.target.files[0];
                         if (file) {
                             const reader = new FileReader();
                             reader.onload = (e) => {
                                 console.log(this.currentArtwork[`image${index}`]);
                                 this.currentArtwork[`image${index}`] = e.target.result;
                                 console.log(this.currentArtwork[`image${index}`]);
                             };
                             reader.readAsDataURL(file);
                          
                         }
                     },
         
                    toggle() {
                        this.showModal = ! this.showModal
                        console.log("the EDIT ART modal has just been toggled to", this.showModal, "\nnote that the modal will silently be set to false if the user navigates")
                    }
                }),
                Alpine.store('editPageModal', {
                    showModal: false,
         
                    toggle() {
                        this.showModal = ! this.showModal
                        console.log("an edit page modal has just been toggled to", this.showModal, "\nnote that the modal will silently be set to false if the user navigates")
                    }
                }),
                Alpine.store('editMenuModal', {
                    showModal: false,
                    font: '{{ page_settings.menu_font }}',
                    fontColor: '{{ page_settings.menu_font_color }}',
                    fontStyle: '{{ page_settings.menu_font_style }}',
                    updateSettings(newSettings) {
                        this.font = newSettings.font;
                        this.fontColor = newSettings.fontColor;
                        this.fontStyle = newSettings.fontStyle; 
                        console.log(
                            'Updated Menu settings - font:', this.font, 
                            'Menu fontColor:', this.fontColor, 
                            'Menu fontStyle:', this.fontStyle
                        );
                    },
                    toggle() {
                        this.showModal = ! this.showModal
                        console.log("an edit menu modal has just been toggled to", this.showModal, "\nnote that the modal will silently be set to false if the user navigates")
                    }
                })
            })
        </script>


        <div id="content"> {% block content %} {% endblock %} </div>


  </body>
</html>


<!-- Form Alerts / Event Listeners for all Forms -->
<script>
     document.body.addEventListener("emailSuccess", function(evt){
        console.log("email alert success");
        alert("Email successfully sent");
     }) 
     document.body.addEventListener("emailFailureFields", function(evt){
        console.log("email alert failure input fields");
        alert("Please make sure all input fields are entered and valid");
     }) 
     document.body.addEventListener("emailFailureHeaders", function(evt){
        console.log("email alert failure header fields");
        alert("Email sending failed due to server issues");
     }) 


     document.body.addEventListener("BlogDescFailure", function(evt){
        console.log("add blog alert failure: add Blog form had an invalid Summernote description form");
        alert("Your blog description was invalid, please try again");
     }) 
     document.body.addEventListener("addBlogFailure", function(evt){
        console.log("add blog alert failure: no first image provided");
        alert("You must provide an image in the first image box");
     }) 
     document.body.addEventListener("editBlogFailure", function(evt){
        console.log("edit blog alert failure: no first image provided");
        alert("You must provide an image in the first image box");
     }) 
     document.body.addEventListener("addArtFailure", function(evt){
        console.log("add art alert failure: no first image provided");
        alert("You must provide an image in the first image box");
     }) 
     document.body.addEventListener("editArtFailure", function(evt){
        console.log("edit art alert failure: no first image provided");
        alert("You must provide an image in the first image box");
     }) 
     document.body.addEventListener("priceFailure", function(evt){
        console.log("art prices alert failure: invalid price numbers");
        alert("The prices were not valid numbers");
     }) 
     
</script>





